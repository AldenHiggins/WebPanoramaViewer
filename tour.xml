<krpano version="1.19" title="Virtual Tour">
	<include url="skin/vtourskin.xml" />

	<!-- customize skin settings: maps, gyro, webvr, thumbnails, tooltips, layout, design, ... -->
	<skin_settings 
		maps="false"
		maps_type="bing"
		maps_bing_api_key=""
		maps_zoombuttons="false"
		gyro="true"
		webvr="true"
		littleplanetintro="false"
		title="true"
		thumbs="true"
		thumbs_width="120" 
		thumbs_height="80"
		thumbs_padding="10" 
		thumbs_crop="0|40|240|160"
		thumbs_opened="false"
		thumbs_text="false"
		thumbs_dragging="true"
		thumbs_onhoverscrolling="false"
		thumbs_scrollbuttons="false"
		thumbs_scrollindicator="false"
		thumbs_loop="false"
		tooltips_buttons="false"
		tooltips_thumbs="false"
		tooltips_hotspots="false"
		tooltips_mapspots="false"
		deeplinking="false"
		loadscene_flags="MERGE"
		loadscene_blend="OPENBLEND(0.5, 0.0, 0.75, 0.05, linear)"
		loadscene_blend_prev="SLIDEBLEND(0.5, 180, 0.75, linear)"
		loadscene_blend_next="SLIDEBLEND(0.5,   0, 0.75, linear)"
		loadingtext="loading..."
		layout_width="100%"
		layout_maxwidth="814"
		controlbar_width="-24"
		controlbar_height="40"
		controlbar_offset="20"
		controlbar_offset_closed="-40"
		controlbar_overlap.no-fractionalscaling="10"
		controlbar_overlap.fractionalscaling="0"
		design_skin_images="vtourskin.png"
		design_bgcolor="0x2D3E50"
		design_bgalpha="0.8"
		design_bgborder="0"
		design_bgroundedge="1"
		design_bgshadow="0 4 10 0x000000 0.3"
		design_thumbborder_bgborder="3 0xFFFFFF 1.0"
		design_thumbborder_padding="2"
		design_thumbborder_bgroundedge="0"
		design_text_css="color:#FFFFFF; font-family:Arial;"
		design_text_shadow="1"
    />

	<plugin name="soundinterface"
	        url="%SWFPATH%/plugins/soundinterface.swf"
	        alturl="%SWFPATH%/plugins/soundinterface.js"
	        rootpath="%CURRENTXML%"
	        onloaded="playsound(bgsnd, 'CLICK.WAV', 0);" 
    />

	<!-- startup action - load the first scene -->
	<action name="startup" autorun="onstart">
		showlog(true);
		trace("Starting up");
		if(startscene === null OR !scene[get(startscene)], copy(startscene,scene[0].name); );
		loadscene(get(startscene), null, MERGE);
		<!-- set(plugin["soundinterface"].onloaded, startSounds()); -->
		if(startactions !== null, startactions() );
		asyncloop(true, updateFunction() );
		createHotspots();
	</action>

	<action name="createHotspots">
		for (set(hotspotIndex, 1), hotspotIndex LT 9, inc(hotspotIndex),
			<!-- Generate the hotspot name -->
			set(hotspotName, "overlay");
			txtadd(hotspotName, get(hotspotName), get(hotspotIndex));

			<!-- Figure out what image file we're going to get the hotspot from -->
			set(imageName, "skin/testOverlay");
			txtadd(imageName, get(imageName), get(hotspotIndex), ".jpg");

			<!-- Calculate the x position of the hotspot -->
			set(xValue, -113.4969);
			set(addThis, 76.6);
			set(multiplyIndex, get(hotspotIndex));
			sub(multiplyIndex, 1);
			mul(addThis, multiplyIndex);
			add(xValue, addThis);

			addhotspot(get(hotspotName));
			set(hotspot[get(hotspotName)].url, get(imageName));
			set(hotspot[get(hotspotName)].ox, get(xValue));
			set(hotspot[get(hotspotName)].oy, "-301.3806");
			set(hotspot[get(hotspotName)].ath, "-90");
			set(hotspot[get(hotspotName)].atv, "0");
			set(hotspot[get(hotspotName)].distorted, "true");
			set(hotspot[get(hotspotName)].edge, "lefttop");
			set(hotspot[get(hotspotName)].capture, "false");
			set(hotspot[get(hotspotName)].visible, "true");
			set(hotspot[get(hotspotName)].keep, "true");
			set(hotspot[get(hotspotName)].scale, "1.0");
			set(hotspot[get(hotspotName)].width, "76.6871");
			set(hotspot[get(hotspotName)].height, "613.4969");
		);		
	</action>

	<action name="updateFunction">
		set(viewH, get(view.hlookat));

		mod(viewH, 360);

		if (viewH LT 0, add(viewH, 360););

		for (set(hotspotIndex, 1), hotspotIndex LT 9, inc(hotspotIndex),
			set(hotspotName, "overlay");
			txtadd(hotspotName, get(hotspotName), get(hotspotIndex));

			set(checkingAngle, 265);
			sub(addToAngle, get(hotspotIndex), 1);
			mul(addToAngle, 10);
			add(checkingAngle, get(addToAngle));

			if (viewH GT checkingAngle, set(hotspot[get(hotspotName)].alpha, "0.0");, set(hotspot[get(hotspotName)].alpha, "1.0"););
		);

		sub(difference, 180, get(viewH));

<!-- 		trace("Diff:");
		trace(difference); -->

		<!-- if (difference GT -30 && difference LT 30, playsound("ParkingAmbiance", "ParkingGarage.wav", 0);); -->

		<!-- if (viewH GT -30 && viewH LT 30, playsound("CityAmbiance", "CityAtmosphere.wav", 0);); -->
	</action>

	<action name="startSounds">
		trace("Starting sounds");
		<!-- playsound("CityAmbiance", "CityAtmosphere.wav", 0); -->
	</action>
	
	<scene name="scene_pano" title="pano" onstart="" thumburl="panos/pano.tiles/thumb.jpg" lat="" lng="" heading="">

		<view hlookat="0" vlookat="0" fovtype="MFOV" fov="120" maxpixelzoom="2.0" fovmin="70" fovmax="140" limitview="auto" />

		<preview url="panos/pano.tiles/preview.jpg" />

		<image>
			<cube url="panos/pano.tiles/pano_%s.jpg" />

			<cube url="panos/pano.tiles/mobile/pano_%s.jpg" devices="mobile" />
		</image>
	</scene>
</krpano>
